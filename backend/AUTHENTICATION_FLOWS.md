# ðŸ”„ Authentication Flow Diagram

## 1. Register Flow (Email & Password)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                  â”‚ Backend â”‚                  â”‚ MongoDB  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                            â”‚                            â”‚
     â”‚ POST /api/auth/register    â”‚                            â”‚
     â”‚ { email, password, name }  â”‚                            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Validate Input             â”‚
     â”‚                            â”‚ (email format, unique)     â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Hash Password (bcrypt)     â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Save User                  â”‚
     â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ User Created               â”‚
     â”‚                            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Generate JWT Token         â”‚
     â”‚                            â”‚ (userId + secret)          â”‚
     â”‚                            â”‚                            â”‚
     â”‚ { success, token, user }   â”‚                            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚ Store token in localStorageâ”‚                           â”‚
     â”‚                            â”‚                            â”‚
```

---

## 2. Login Flow (Email & Password)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                  â”‚ Backend â”‚                  â”‚ MongoDB  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                            â”‚                            â”‚
     â”‚ POST /api/auth/login       â”‚                            â”‚
     â”‚ { email, password }        â”‚                            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Find User by Email         â”‚
     â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ User Data (with password)  â”‚
     â”‚                            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Compare Password           â”‚
     â”‚                            â”‚ bcrypt.compare()           â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ âœ… Password Match          â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Generate JWT Token         â”‚
     â”‚                            â”‚                            â”‚
     â”‚ { success, token, user }   â”‚                            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚ Store token in localStorageâ”‚                           â”‚
     â”‚                            â”‚                            â”‚
```

---

## 3. Google OAuth Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚      â”‚   Google   â”‚      â”‚ Backend â”‚      â”‚ MongoDB  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚                   â”‚                â”‚
     â”‚ Click "Sign in with Google"        â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚ Google Login UI â”‚                   â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚ Enter Credentials                   â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚ Google JWT Token (credential)       â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚ POST /api/auth/google               â”‚                â”‚
     â”‚ { credential }                      â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚                 â”‚ Verify Token      â”‚                â”‚
     â”‚                 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚                 â”‚ User Info         â”‚                â”‚
     â”‚                 â”‚ (email, name, pic)â”‚                â”‚
     â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚                 â”‚                   â”‚ Find by Email  â”‚
     â”‚                 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚                 â”‚                   â”‚ User Exists?   â”‚
     â”‚                 â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                 â”‚                   â”‚                â”‚
     â”‚                 â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
     â”‚                 â”‚         â”‚ User NOT Found    â”‚      â”‚
     â”‚                 â”‚         â”‚ Create New User   â”‚      â”‚
     â”‚                 â”‚         â”‚ with Google data  â”‚      â”‚
     â”‚                 â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚                 â”‚                   â”‚ Save User      â”‚
     â”‚                 â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚                 â”‚                   â”‚ Generate JWT   â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚ { success, token, user }            â”‚                â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
     â”‚                 â”‚                   â”‚                â”‚
     â”‚ Store token in localStorage         â”‚                â”‚
     â”‚                 â”‚                   â”‚                â”‚
```

---

## 4. Protected Route Access

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                  â”‚ Backend â”‚                  â”‚ MongoDB  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                            â”‚                            â”‚
     â”‚ GET /api/orders            â”‚                            â”‚
     â”‚ Header: "Bearer <token>"   â”‚                            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Middleware: protect()      â”‚
     â”‚                            â”‚ Extract token from header  â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Verify JWT Token           â”‚
     â”‚                            â”‚ jwt.verify(token, secret)  â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ âœ… Token Valid             â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Get userId from token      â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Find User by ID            â”‚
     â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ User Data                  â”‚
     â”‚                            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Attach user to req.user    â”‚
     â”‚                            â”‚                            â”‚
     â”‚                            â”‚ Execute route handler      â”‚
     â”‚                            â”‚ (orderController)          â”‚
     â”‚                            â”‚                            â”‚
     â”‚ { success, data }          â”‚                            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
     â”‚                            â”‚                            â”‚
```

---

## Password Hashing Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plain Password   â”‚
â”‚ "password123"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ bcrypt.genSalt(10)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Salt Generated   â”‚
â”‚ "$2a$10$..."     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ bcrypt.hash(password, salt)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hashed Password (stored in MongoDB)      â”‚
â”‚ "$2a$10$N9qo8uLOickgx2ZMRZoMye..."      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## JWT Token Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JWT TOKEN                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  HEADER.PAYLOAD.SIGNATURE                          â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Header  â”‚  â”‚ Payload  â”‚  â”‚  Signature   â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚ {       â”‚  â”‚ {        â”‚  â”‚ HMACSHA256(  â”‚      â”‚
â”‚  â”‚  alg:   â”‚  â”‚  id:     â”‚  â”‚  base64(hdr) â”‚      â”‚
â”‚  â”‚  HS256  â”‚  â”‚  userId  â”‚  â”‚  + "." +     â”‚      â”‚
â”‚  â”‚  typ:   â”‚  â”‚  iat:    â”‚  â”‚  base64(pay) â”‚      â”‚
â”‚  â”‚  JWT    â”‚  â”‚  1234... â”‚  â”‚  , secret)   â”‚      â”‚
â”‚  â”‚ }       â”‚  â”‚  exp:    â”‚  â”‚              â”‚      â”‚
â”‚  â”‚         â”‚  â”‚  1234... â”‚  â”‚              â”‚      â”‚
â”‚  â”‚         â”‚  â”‚ }        â”‚  â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                     â”‚
â”‚  Base64     .  Base64    .  Encrypted             â”‚
â”‚  Encoded       Encoded      Signature              â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Token Example:
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJpZCI6IjY1YTFiMmMzZDRlNWY2ZzciLCJpYXQiOjE3MDUwODk2MDAsImV4cCI6MTcwNTY5NDQwMH0.
K5xN8q_X4YzJ9TlMhPfK3nR8sL6wA2vB7cD9eE0fG1h
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     User Collection                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  _id: ObjectId("65a1b2c3d4e5f6g7")                   â”‚
â”‚  name: "John Doe"                                     â”‚
â”‚  email: "john@example.com"                            â”‚
â”‚  password: "$2a$10$N9qo8uLO..."  (hashed)            â”‚
â”‚  googleId: "1234567890"            (optional)         â”‚
â”‚  isVerified: true                                     â”‚
â”‚  phone: "08123456789"                                 â”‚
â”‚  avatar: "https://cloudinary.com/..."                 â”‚
â”‚  role: "user"                                         â”‚
â”‚  isJastiper: false                                    â”‚
â”‚                                                        â”‚
â”‚  jastipProfile: {                                     â”‚
â”‚    rating: 4.5,                                       â”‚
â”‚    totalTrips: 0,                                     â”‚
â”‚    verificationStatus: "unverified"                   â”‚
â”‚  }                                                     â”‚
â”‚                                                        â”‚
â”‚  addresses: [                                         â”‚
â”‚    {                                                   â”‚
â”‚      label: "Home",                                   â”‚
â”‚      fullAddress: "Jl. Sudirman No. 123",            â”‚
â”‚      city: "Jakarta",                                 â”‚
â”‚      isDefault: true                                  â”‚
â”‚    }                                                   â”‚
â”‚  ]                                                     â”‚
â”‚                                                        â”‚
â”‚  createdAt: 2025-01-01T00:00:00.000Z                 â”‚
â”‚  updatedAt: 2025-01-15T10:30:00.000Z                 â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
